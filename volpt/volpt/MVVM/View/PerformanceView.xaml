<UserControl x:Class="volpt.MVVM.View.PerformanceView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:volpt.MVVM.View"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d" 
             SnapsToDevicePixels="True"
             UseLayoutRounding="True"
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <x:Array x:Key="GradesList" Type="{x:Type sys:String}">
            <x:Static Member="sys:String.Empty" />
            <sys:String>2</sys:String>
            <sys:String>3</sys:String>
            <sys:String>4</sys:String>
            <sys:String>5</sys:String>
        </x:Array>
    </UserControl.Resources>
    <Grid  Background="{StaticResource BackgroundLightBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <!-- Основная таблица с тремя частями -->
        <Grid  Grid.Row="0" Height="40">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200" MinWidth="150"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="80" MinWidth="70"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" BorderBrush="{StaticResource PrimaryColorBrush}" BorderThickness="0,0,1,1">
                    <TextBlock Text="Студент" Style="{StaticResource H5}"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"
                               FontWeight="Bold"/>
            </Border>

            <ScrollViewer Grid.Column="1" 
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Hidden">
                    <StackPanel Orientation="Horizontal">
                        <ItemsControl ItemsSource="{Binding Dates}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Width="100" 
                                            BorderBrush="{StaticResource PrimaryColorBrush}" 
                                            BorderThickness="0,0,1,1"
                                            Padding="5">
                                        <TextBlock Text="{Binding StringFormat='dd.MM.yyyy'}" Style="{StaticResource H6}"
                                                  Height="auto"
                                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                                   RenderTransformOrigin="0.5,0.5">
                                                <TextBlock.RenderTransform>
                                                    <TransformGroup>
                                                        <ScaleTransform/>
                                                        <SkewTransform/>
                                                        <RotateTransform Angle="-90"/>
                                                        <TranslateTransform/>
                                                    </TransformGroup>
                                                </TextBlock.RenderTransform>
                                    </TextBlock>
                                </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </StackPanel>
            </ScrollViewer>

            <Border Grid.Column="2" BorderBrush="{StaticResource PrimaryColorBrush}" BorderThickness="0,0,0,1">
                    <TextBlock Text="Средняя" 
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"
                               FontWeight="Bold"/>
            </Border>

        </Grid>
        <!-- Тело таблицы -->
        <ScrollViewer Grid.Row="1" Grid.ColumnSpan="3" 
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled">
            <ItemsControl ItemsSource="{Binding Students}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="40">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="200"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="80"/>
                            </Grid.ColumnDefinitions>

                            <!-- Имя студента -->
                            <Border Grid.Column="0" 
                                        BorderBrush="{StaticResource PrimaryColorBrush}" 
                                        BorderThickness="0,0,1,0"
                                        Background="Transparent">
                                <TextBlock Text="{Binding FullName}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Left"
                                               Margin="5"/>
                            </Border>

                            <!-- Оценки по датам -->
                            <ScrollViewer Grid.Column="1" 
                                              HorizontalScrollBarVisibility="Auto"
                                              VerticalScrollBarVisibility="Hidden">
                                <StackPanel Orientation="Horizontal">
                                    <ItemsControl ItemsSource="{Binding Grades}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Width="100" 
                                                            BorderBrush="{StaticResource PrimaryColorBrush}" 
                                                            BorderThickness="0,0,1,0"
                                                            Padding="5">
                                                    <ComboBox SelectedItem="{Binding Value}"
                                                                  ItemsSource="{Binding Source={StaticResource GradesList}}"
                                                                  BorderThickness="0"
                                                                  Background="Transparent"
                                                                  HorizontalAlignment="Stretch"
                                                                  VerticalAlignment="Center"/>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel Orientation="Horizontal"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                    </ItemsControl>
                                </StackPanel>
                            </ScrollViewer>

                            <!-- Средняя оценка -->
                            <Border Grid.Column="2" 
                                        BorderBrush="{StaticResource PrimaryColorBrush}" 
                                        BorderThickness="0,0,0,0">
                                <TextBlock Text="{Binding AverageGrade, StringFormat='0.00'}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Center"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource AccentLightBrush}"/>
                            </Border>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>
